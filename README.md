# Determining biallelic gene status 

## Package description
hmfGeneAnnotation is a pipeline designed to determine the biallelic status of a gene or set of genes based on copy number and SNV/indel data generating by the HMF variant calling pipeline. The pipeline outputs a 'diplotypes' table where each row contains variant info for allele 1 and allele 2. Each variant is given an impact score from 0-5, variant pair scores summing to a maximum of 10. 

## Required input data
### Generated by HMF pipeline
- Copy number info per gene (\*.purple.gene.cnv)
- Germline SNV/indel vcf (\*.annotated.vcf.gz)
- Somatic SNV/indel vcf (\*\_post_processed.vcf.gz)

### Other
- Bed file with the chromosome, start position, and end position of the desired genes. See hmfGeneAnnotation/data/gene_selection/genes.bed as an example.

## Usage
hmfGeneAnnotation/scripts/pipeline/pipeline.sh -b $bed_path -c $gene_cnv_path -g $germ_vcf_path -s $som_vcf_path -o $out_dir -n $sample_name

## Pipeline workflow
### Copy number
- If min copy number < 0.3: flag as full gene loss. Assign score of 5+5
- Else if max copy number < 0.3: flag as truncation. Assign score of 5+5
- Else if min minor allele ploidy < 0.2: flag as LOH. Assign score of 5 to allele 1
- Else flag as no copy number variant

### SNV/indels
- Flag origin of variant (i.e. germline or somatic)
- Determine variant type with SnpEff. Assign impact score. 5: frameshift, 4: nonsense, splice, 3: missense, inframe indel, 2,1,0: other variants
- Retrieve ClinVar annotations. Assign impact score. 5: pathogenic, 4: likely pathogenic, 3: variant of unknown significance (VUS), 2: likely benign, 1: benign, 0: no data available
- Determine maximum impact score

### Combine monoallelic events
- If full gene loss or truncation, duplicate info in both allele 1 and 2
- Else make all pairs of the following variants: LOH, germline SNV/indel, somatic SNV/indel
- Calculate variant pair score ('hit score')
- Determine variant pair with the highest hit score

### Output
- A table containing all variant pairs
- A table containing the maximum impact variant pair for each gene


